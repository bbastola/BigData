Get details of top 5 customers by revenue for each month
We need to get all the details of the customer along with month and revenue per month
Data need to be sorted by month in ascending order and revenue per month in descending order

sqlContext.sql("use bbastola_retail_db_txt")
sqlContext.sql("show tables").show()

finalResult = sqlContext.sql("select tmp.month, tmp.customer_id, tmp.revenue_per_month_per_customer from \
(select cast(concat(substr(order_date, 1,4), substr(order_date, 6,2)) as int) month, \
customer_id, \
sum(order_item_subtotal) revenue_per_month_per_customer, \
rank() over (partition by cast(concat(substr(order_date, 1,4), substr(order_date, 6, 2)) as int) \ 
order by sum(order_item_subtotal) desc) rank \
from orders join order_items \
on order_id = order_item_order_id \
join customers \
on order_customer_id = customer_id \
group by cast(concat(substr(order_date, 1,4), substr(order_date, 6, 2)) as int), \
customer_id \
order by month, revenue_per_month_per_customer desc) tmp \
where tmp.rank <=5") 





