Problem Statement:

Get top 3 departments with highest revenue for each date.


sqlContext.sql("use xueling12_retail_db")
sqlContext.sql("show tables").show() 


sqlContext.sql("select * from ( \
select substr(order_date, 1, 10) order_date, department_name, round(sum(order_item_subtotal), 2) total_revenue, \
rank() over(partition by substr(order_date, 1, 10) order by round(sum(order_item_subtotal), 2) desc) rank \
from orders join order_items on order_id = order_item_order_id \
join products on product_id = order_item_product_id \
join categories on category_id = product_category_id \
join departments on department_id = category_department_id \
group by substr(order_date, 1, 10), department_name) temp \
where rank <=3 \
order by order_date, total_revenue desc").show() 

