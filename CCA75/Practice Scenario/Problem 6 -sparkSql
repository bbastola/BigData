Duration: 20 to 30 minutes

Tables should be in hive database - <YOUR_USER_ID>_retail_db_txt
orders
order_items
customers

Time to create database and tables need not be counted. Make sure to go back to Spark SQL module and create tables and load data

Get details of top 5 customers by revenue for each month
We need to get all the details of the customer along with month and revenue per month

Data need to be sorted by month in ascending order and revenue per month in descending order

Create table top5_customers_per_month in <YOUR_USER_ID>_retail_db_txt

Insert the output into the newly created table

solutions:

sqlContext.sql("use bbastola_retail_db_txt")


top5Customers = sqlContext.sql("select c.customer_id, c.customer_fname, c.customer_lname, substr(o.order_date, 1, 7) as month, \
round(sum(order_item_subtotal), 2) as monthly_revenue from \
orders o join order_items oi on o.order_id=oi.order_item_order_id \
join customers c on c.customer_id=o.order_customer_id \
group by c.customer_id, c.customer_fname, c.customer_lname, substr(o.order_date, 1, 7) \
order by month, monthly_revenue desc limit 5")

top5Customers.registerTempTable("top5Customers")



sqlContext.sql("create table bbastola_retail_db_txt.top5_customers_per_month as select * from top5Customers")
