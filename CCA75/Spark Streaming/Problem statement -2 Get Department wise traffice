Problem statement -2 Get Department wise traffice every 30 sec

-Read data from retail_db logs  --> location of logs /opt/gen_logs/logs/access/log
-Computer department traffic every 30 secs
-Save the output to HDFS

note: run tail -logs.sh to see if the messages are constantly being generated
if screen is not refreshing then,
start_logs.sh

Solutions
-Use spark streaming
-publish messages from retail_db logs to netcat
-create Dstream
-process and save the output


from pyspark import SparkContext, SparkConf
from pyspark.streaming import StreamingContext

conf = SparkConf().setAppName("Department Traffic").setMaster("yarn-client")
sc = SparkContext(conf=conf)
ssc = StreamingContext(sc, 30)

traffic = ssc.socketTextStream("gw02.itversity.com", 19777)
messageFilter = traffic.filter(lambda msg: msg.split(" ")[6])
department = messageFilter.map(lambda msg: (msg.split("/")[2], 1))
from operator import add 
departmentCount = department.reducByKey(add)
departmentCount.saveAsTextFile("/user/bbastola/streamingApps/departmentTraffic.txt")

ssc.start()
ssc.awaitTermination()


to run from one terminal
tail_logs.sh | nc -lk gwo2.itversity.com 19777